org: kevinchan950120
app: aws-serverless
service: microservice-1

params:
  dev:
    security_group_ids: ${env:DEV_SECURITY_GROUP_IDS}
    subnet_id_1: ${env:DEV_SUBNET_ID1}
    subnet_id_2: ${env:DEV_SUBNET_ID2}
    subnet_id_3: ${env:DEV_SUBNET_ID3}
  default:
    security_group_ids: ${env:DEV_SECURITY_GROUP_IDS}
    subnet_id_1: ${env:DEV_SUBNET_ID1}
    subnet_id_2: ${env:DEV_SUBNET_ID2}
    subnet_id_3: ${env:DEV_SUBNET_ID3}

useDotenv: true

custom:
  esbuild:
    sourcemap: true

  serverless-offline:
    httpPort: 4001
    noAuth: true

package:
  individually: true

provider:
  name: aws
  runtime: nodejs18.x
  stage: dev
  region: ap-southeast-1

  tracing:
    lambda: true

  vpc:
    securityGroupIds:
      - ${param:security_group_ids}
    subnetIds:
      - ${param:subnet_id_1}
      - ${param:subnet_id_2}
      - ${param:subnet_id_3}

functions:
  ping:
    handler: src/services/ping/index.handler
    timeout: 30
    events:
      - httpApi:
          method: GET
          path: /ping-test
  retrieve-posts:
    handler: src/services/posts/index.postsHandler.retrievePosts
